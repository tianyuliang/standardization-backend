# 目录管理接口流程说明文档

> 文档版本：2.0（完整版）
> 创建日期：2026-02-04
> 更新时间：2026-02-06
> 适用版本：standardization-backend v1.0+

---

## 一、业务概述

### 1.1 功能描述

目录管理模块用于管理系统中的目录结构（Catalog），支持以下核心功能：

- **目录查询**：支持按类型、名称等多维度查询目录树或列表
- **目录创建**：支持创建多级目录
- **目录编辑**：支持修改目录信息
- **目录删除**：支持删除目录及其子集
- **目录移动**：支持移动目录到其他父级

### 1.2 基础路径

```
基础路径：/api/standardization/v1/catalog
```

### 1.3 接口清单（共10个）

| 序号 | 方法 | 路径 | 功能说明 |
|------|------|------|----------|
| 1 | GET | `/v1/catalog/query_tree` | 查询目录树 |
| 2 | GET | `/v1/catalog/query` | 检索目录 |
| 3 | GET | `/v1/catalog/{id}` | 查看目录详情（已废弃） |
| 4 | POST | `/v1/catalog` | 创建目录 |
| 5 | PUT | `/v1/catalog/{id}` | 修改目录 |
| 6 | DELETE | `/v1/catalog/{id}` | 删除目录 |
| 7 | GET | `/v1/catalog/query_tree_by_file` | 查询文件目录树（已废弃） |
| 8 | GET | `/v1/catalog/query/with_file` | 查询目录及文件树 |
| 9 | PUT | `/v1/catalog/remove` | 移除目录 |
| 10 | PUT | `/v1/catalog/{id}/state` | 启用/停用 |

---

## 二、数据库表结构

### 2.1 目录表（t_de_catalog_info）

```sql
CREATE TABLE `t_de_catalog_info` (
  `f_id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '目录唯一标识',
  `f_catalog_name` varchar(20) NOT NULL COMMENT '目录名称',
  `f_description` varchar(300) DEFAULT NULL COMMENT '目录说明',
  `f_level` INT(4) NOT NULL DEFAULT 1 COMMENT '目录级别',
  `f_parent_id` bigint(20) DEFAULT NULL COMMENT '父级标识',
  `f_type` INT(2) NOT NULL COMMENT '目录类型',
  `f_authority_id` varchar(100) DEFAULT NULL COMMENT '权限域',
  `f_create_time` datetime DEFAULT NULL COMMENT '创建时间',
  `f_create_user` varchar(128) DEFAULT NULL COMMENT '创建用户',
  `f_update_time` datetime DEFAULT NULL COMMENT '修改时间',
  `f_update_user` varchar(128) DEFAULT NULL COMMENT '修改用户',
  `f_deleted` bigint(20) NOT NULL DEFAULT 0 COMMENT '逻辑删除标记',
  PRIMARY KEY (`f_id`),
  KEY `idx_parent_id` (`f_parent_id`),
  KEY `idx_type_deleted` (`f_type`,`f_deleted`)
) COMMENT='目录信息表';
```

---

## 三、枚举定义

### 3.1 目录类型枚举（CatalogTypeEnum）

| 枚举值 | code | 说明 |
|--------|------|------|
| DataElement | 1 | 数据元目录 |
| Dict | 2 | 码表目录 |
| ValueRule | 3 | 编码规则目录 |
| File | 4 | 文件目录 |

---

## 四、数据模型定义

### 4.1 创建目录请求

```json
{
  "catalogName": "目录名称",
  "parentId": 0,
  "type": 1,
  "description": "目录说明"
}
```

| 字段名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| catalogName | String | 是 | 目录名称，最大20字符 |
| parentId | Long | 是 | 父级ID，0表示顶级目录 |
| type | Integer | 是 | 目录类型：1-数据元，2-码表，3-编码规则，4-文件 |
| description | String | 否 | 目录说明，最大300字符 |

### 4.2 目录详情响应

```json
{
  "id": 33,
  "catalogName": "目录名称",
  "description": "目录说明",
  "level": 2,
  "parentId": 0,
  "type": 1,
  "children": [...]
}
```

### 4.3 统一响应结构

```json
{
  "code": "0",
  "description": "操作成功",
  "data": {...}
}
```

---

## 五、接口详细说明

### 5.1 查询目录树

**接口路径**：`GET /api/standardization/v1/catalog/query_tree`

#### 请求参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| type | Integer | 否 | 目录类型：1-数据元，2-码表，3-编码规则，4-文件 |
| id | Long | 否 | 目录ID，指定则查询该目录及其子集 |

#### 响应参数

返回目录树结构，支持递归子级

#### 业务逻辑

```
1. 校验目录类型
2. 获取根目录列表
3. 递归获取子级目录
4. 返回树形结构
```

---

### 5.2 检索目录

**接口路径**：`GET /api/standardization/v1/catalog/query`

#### 请求参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| type | Integer | 是 | 目录类型 |
| keyword | String | 否 | 搜索关键字 |

#### 响应参数

返回平铺的目录列表

---

### 5.3 创建目录

**接口路径**：`POST /api/standardization/v1/catalog`

#### 请求参数

参考创建目录请求

#### 业务逻辑

```
1. 参数校验
2. 校验目录名称（长度、格式、重复）
3. 校验父级目录存在性
4. 校验目录类型（子目录继承父目录类型）
5. 生成目录ID
6. 保存数据库
```

#### 异常提示

| 序号 | 错误码 | 字段 | 提示信息 |
|------|--------|------|----------|
| 1 | InvalidParameter | catalog_name | 目录名称长度不能超过20个字符 |
| 2 | InvalidParameter | catalog_name | 目录名称只能由中英文、数字、下划线、中划线组成 |
| 3 | InvalidParameter | catalog_name | 目录名称不能以下划线或中划线开头 |
| 4 | InvalidParameter | parent_id | 父级目录不存在 |
| 5 | InvalidParameter | type | 目录类型不能为空 |
| 6 | InvalidParameter | type | 子目录类型必须与父目录一致 |
| 7 | InvalidParameter | level | 目录级别最大为255 |

---

### 5.4 修改目录

**接口路径**：`PUT /api/standardization/v1/catalog/{id}`

#### 请求参数

```json
{
  "catalogName": "修改后的目录名称",
  "description": "修改后的目录说明"
}
```

#### 业务逻辑

```
1. 校验目录存在性
2. 校验目录名称（不重复）
3. 更新目录信息
```

---

### 5.5 删除目录

**接口路径**：`DELETE /api/standardization/v1/catalog/{id}`

#### 业务逻辑

```
1. 校验目录存在性
2. 不允许删除根目录
3. 不允许删除包含数据的目录
4. 递归删除所有子级目录
```

#### 异常提示

| 序号 | 错误码 | 字段 | 提示信息 |
|------|--------|------|----------|
| 1 | InvalidParameter | id | 根目录不允许删除 |
| 2 | InvalidParameter | id | 该目录下存在子集或数据，不允许删除 |

---

### 5.6 查询目录及文件树

**接口路径**：`GET /api/standardization/v1/catalog/query/with_file`

#### 请求参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| type | Integer | 是 | 目录类型 |
| keyword | String | 否 | 搜索关键字 |

#### 响应参数

返回目录树结构，每层包含该目录下的文件

---

### 5.7 移除目录

**接口路径**：`PUT /api/standardization/v1/catalog/remove`

#### 请求参数

```json
{
  "ids": [1, 2, 3],
  "catalogId": 331
}
```

| 字段名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| ids | List<Long> | 是 | 待移除的数据ID列表 |
| catalogId | Long | 是 | 目标目录ID |

---

### 5.8 启用/停用目录

**接口路径**：`PUT /api/standardization/v1/catalog/{id}/state`

#### 请求参数

```json
{
  "state": "disable"
}
```

---

## 六、目录名称校验规则

### 6.1 校验规则

| 规则 | 说明 |
|------|------|
| 长度 | 最大20个字符 |
| 字符集 | 中英文、数字、下划线(_)、中划线(-) |
| 首字符 | 不能以下划线或中划线开头 |

### 6.2 目录级别

- 范围：1-255
- 子目录继承父目录的level+1

---

## 七、依赖服务说明

### 7.1 内部服务依赖

| 服务 | 用途 |
|------|------|
| DeCatalogInfoMapper | 目录数据访问 |
| DataElementInfoMapper | 数据元统计 |
| StdFileMgrMapper | 文件统计 |
| RuleMapper | 规则统计 |
| DictMapper | 码表统计 |

---

## 八、Go语言开发参考

### 8.1 关键Go结构体示例

```go
// 目录实体
type Catalog struct {
    ID           int64   `json:"id" gorm:"primaryKey;column:f_id"`
    CatalogName  string  `json:"catalogName" gorm:"column:f_catalog_name"`
    Description  string  `json:"description" gorm:"column:f_description"`
    Level        int     `json:"level" gorm:"column:f_level"`
    ParentID     *int64  `json:"parentId" gorm:"column:f_parent_id"`
    Type         int     `json:"type" gorm:"column:f_type"`
    AuthorityID  string  `json:"authorityId" gorm:"column:f_authority_id"`
    CreateTime   string  `json:"createTime" gorm:"column:f_create_time"`
    CreateUser   string  `json:"createUser" gorm:"column:f_create_user"`
    UpdateTime   string  `json:"updateTime" gorm:"column:f_update_time"`
    UpdateUser   string  `json:"updateUser" gorm:"column:f_update_user"`
    Deleted      int     `json:"deleted" gorm:"column:f_deleted"`
    Children     []Catalog `json:"children,omitempty" gorm:"-"`
}
```

---

> 文档结束

> 最后更新时间：2026-02-06
> 维护者：Claude Code
