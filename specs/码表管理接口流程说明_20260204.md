# 码表管理接口流程说明文档

> 文档版本：2.0（完整版）
> 创建日期：2026-02-04
> 更新时间：2026-02-06
> 适用版本：standardization-backend v1.0+

---

## 一、业务概述

### 1.1 功能描述

码表管理模块用于管理系统中的码表（Dictionary），支持以下核心功能：

- **码表创建**：支持新增码表及码值明细
- **码表查询**：支持按目录、关键字、状态等多维度分页查询
- **码表编辑**：支持修改码表信息
- **码表删除**：支持单个或批量删除
- **启用/停用**：支持启用/停用操作
- **码值管理**：支持查询、添加、修改码值明细
- **关联查询**：支持查询引用码表的数据元和标准文件

### 1.2 基础路径

```
基础路径：/api/standardization/v1/dataelement/dict
```

### 1.3 接口清单（共18个）

| 序号 | 方法 | 路径 | 功能说明 |
|------|------|------|----------|
| 1 | GET | `/v1/dataelement/dict` | 码表列表查询 |
| 2 | GET | `/v1/dataelement/dict/{id}` | 码表详情（按ID） |
| 3 | GET | `/v1/dataelement/dict/code/{code}` | 码表详情（按Code） |
| 4 | POST | `/v1/dataelement/dict` | 新增码表 |
| 5 | PUT | `/v1/dataelement/dict/{id}` | 修改码表 |
| 6 | DELETE | `/v1/dataelement/dict/{id}` | 删除码表 |
| 7 | DELETE | `/v1/dataelement/dict/batch/{ids}` | 批量删除 |
| 8 | PUT | `/v1/dataelement/dict/state/{id}` | 启用/停用 |
| 9 | GET | `/v1/dataelement/dict/enum` | 码值分页查询 |
| 10 | GET | `/v1/dataelement/dict/enum/getList` | 码值列表查询 |
| 11 | GET | `/v1/dataelement/dict/dataelement/{id}` | 查询引用码表的数据元 |
| 12 | POST | `/v1/dataelement/dict/import` | 导入 |
| 13 | POST | `/v1/dataelement/dict/export` | 导出 |
| 14 | GET | `/v1/dataelement/dict/queryByStdFileCatalog` | 按文件目录查询 |
| 15 | GET | `/v1/dataelement/dict/queryByStdFile` | 按文件查询 |
| 16 | GET | `/v1/dataelement/dict/relation/stdfile/{id}` | 查询关联标准文件 |
| 17 | PUT | `/v1/dataelement/dict/relation/{id}` | 添加关联关系 |
| 18 | GET | `/v1/dataelement/dict/queryDataExists` | 查询数据是否存在 |

---

## 二、数据库表结构

### 2.1 码表主表（t_dict）

```sql
CREATE TABLE `t_dict` (
  `f_id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '主键',
  `f_code` bigint(20) NOT NULL COMMENT '码表编码',
  `f_ch_name` varchar(128) NOT NULL COMMENT '中文名称',
  `f_en_name` varchar(128) NOT NULL COMMENT '英文名称',
  `f_description` varchar(300) DEFAULT NULL COMMENT '业务含义',
  `f_catalog_id` bigint(20) NOT NULL COMMENT '目录ID',
  `f_org_type` INT(2) NOT NULL COMMENT '所属组织类型',
  `f_version` INT(4) NOT NULL DEFAULT 1 COMMENT '版本号',
  `f_state` INT(2) NOT NULL DEFAULT 1 COMMENT '状态：1-启用，0-停用',
  `f_disable_reason` VARCHAR(1024) DEFAULT NULL COMMENT '停用原因',
  `f_authority_id` varchar(100) DEFAULT NULL COMMENT '权限域',
  `f_department_ids` varchar(350) DEFAULT NULL COMMENT '部门ID',
  `f_third_dept_id` varchar(36) DEFAULT NULL COMMENT '第三方部门ID',
  `f_create_time` datetime DEFAULT NULL COMMENT '创建时间',
  `f_create_user` varchar(128) DEFAULT NULL COMMENT '创建用户',
  `f_update_time` datetime DEFAULT NULL COMMENT '修改时间',
  `f_update_user` varchar(128) DEFAULT NULL COMMENT '修改用户',
  `f_deleted` bigint(20) NOT NULL DEFAULT 0 COMMENT '逻辑删除标记',
  PRIMARY KEY (`f_id`),
  KEY `idx_code` (`f_code`),
  KEY `idx_orgtype_deleted` (`f_org_type`,`f_deleted`)
) COMMENT='码表主表';
```

### 2.2 码表明细表（t_dict_enum）

```sql
CREATE TABLE `t_dict_enum` (
  `f_id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '主键',
  `f_dict_id` bigint(20) NOT NULL COMMENT '码表ID',
  `f_code` varchar(50) NOT NULL COMMENT '码值',
  `f_value` varchar(128) NOT NULL COMMENT '码值描述',
  `f_create_time` datetime DEFAULT NULL COMMENT '创建时间',
  `f_create_user` varchar(128) DEFAULT NULL COMMENT '创建用户',
  PRIMARY KEY (`f_id`),
  KEY `idx_dict_id` (`f_dict_id`),
  KEY `idx_code` (`f_code`)
) COMMENT='码表明细表';
```

### 2.3 码表-文件关系表（t_relation_dict_file）

```sql
CREATE TABLE `t_relation_dict_file` (
  `f_id` bigint(20) NOT NULL COMMENT '主键',
  `f_dict_id` bigint(20) NOT NULL COMMENT '码表ID',
  `f_file_id` bigint(20) NOT NULL COMMENT '文件ID',
  UNIQUE KEY `uk_dictid_fileid` (`f_dict_id`,`f_file_id`),
  PRIMARY KEY (`f_id`)
) COMMENT='码表-文件关系表';
```

---

## 三、枚举定义

### 3.1 标准分类枚举（OrgTypeEnum）

| 枚举值 | code | 说明 |
|--------|------|------|
| GROUP | 0 | 团体标准 |
| ENTERPRISE | 1 | 企业标准 |
| INDUSTRY | 2 | 行业标准 |
| LOCAL | 3 | 地方标准 |
| NATIONAL | 4 | 国家标准 |
| INTERNATIONAL | 5 | 国际标准 |
| FOREIGN | 6 | 国外标准 |
| OTHER | 99 | 其他标准 |

### 3.2 启用停用状态枚举（EnableDisableStatusEnum）

| 枚举值 | code | 说明 |
|--------|------|------|
| ENABLE | 1 | 启用 |
| DISABLE | 0 | 停用 |

---

## 四、数据模型定义

### 4.1 创建码表请求（DictDto）

```json
{
  "chName": "性别码表",
  "enName": "Gender",
  "description": "性别字典",
  "orgType": 0,
  "catalogId": 34,
  "enums": [
    {"code": "M", "value": "男"},
    {"code": "F", "value": "女"}
  ],
  "stdFiles": [1, 2, 3],
  "departmentIds": "a/ab"
}
```

| 字段名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| chName | String | 是 | 中文名称，最大128字符 |
| enName | String | 是 | 英文名称，最大128字符 |
| description | String | 否 | 业务含义，最大300字符 |
| orgType | Integer | 是 | 标准分类：0-99 |
| catalogId | Long | 是 | 目录ID |
| enums | List<DictEnumVo> | 是 | 码值列表，至少1条 |
| stdFiles | List<Long> | 否 | 关联文件ID列表 |
| departmentIds | String | 否 | 部门ID |

### 4.2 码值明细（DictEnumVo）

```json
{
  "code": "M",
  "value": "男"
}
```

| 字段名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| code | String | 是 | 码值，最大50字符 |
| value | String | 是 | 码值描述，最大128字符 |

### 4.3 码表响应（DictVo）

```json
{
  "id": 1234567890,
  "code": 1234567890,
  "chName": "性别码表",
  "enName": "Gender",
  "description": "性别字典",
  "orgType": 0,
  "version": 1,
  "state": "enable",
  "usedFlag": false,
  "catalogId": 34,
  "catalogName": "码表目录",
  "enums": [
    {"id": 1, "code": "M", "value": "男"},
    {"id": 2, "code": "F", "value": "女"}
  ],
  "departmentId": "a/ab",
  "departmentName": "部门A",
  "departmentPathNames": "部门A/部门B",
  "createTime": "2022-11-21 12:00:00",
  "createUser": "创建用户",
  "updateTime": "2022-11-21 12:00:00",
  "updateUser": "修改用户"
}
```

### 4.4 状态更新请求

```json
{
  "state": "disable",
  "reason": "停用原因"
}
```

### 4.5 统一响应结构

```json
{
  "code": "0",
  "description": "操作成功",
  "data": {...},
  "totalCount": 100
}
```

---

## 五、接口详细说明

### 5.1 码表列表查询

**接口路径**：`GET /api/standardization/v1/dataelement/dict`

#### 请求参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| catalog_id | Long | 否 | 目录ID |
| keyword | String | 否 | 搜索关键字 |
| org_type | Integer | 否 | 标准分类：0-99 |
| state | String | 否 | enable/disable |
| offset | Integer | 否 | 分页页码，默认1 |
| limit | Integer | 否 | 条数，默认20 |
| sort | String | 否 | 排序字段 |
| direction | String | 否 | asc/desc |
| department_id | String | 否 | 部门ID |

#### 业务逻辑

```
1. 处理目录ID（获取当前目录及所有子目录ID列表）
2. 构建查询条件
3. 分页查询
4. 数据处理（查询是否被引用、查询部门信息）
```

---

### 5.2 码表详情（按ID）

**接口路径**：`GET /api/standardization/v1/dataelement/dict/{id}`

#### 响应参数

返回完整DictVo，包含码值列表

#### 业务逻辑

```
1. 查询码表基本信息
2. 查询码值明细列表
3. 查询目录信息
4. 查询部门信息
```

---

### 5.3 新增码表

**接口路径**：`POST /api/standardization/v1/dataelement/dict`

#### 请求参数

参考DictDto

#### 业务逻辑

```
1. 参数校验
2. 业务校验（目录存在性、名称唯一性）
3. 生成码表编码（雪花算法）
4. 保存码表
5. 保存码值明细
6. 保存关联文件关系
```

#### 异常提示

| 序号 | 错误码 | 字段 | 提示信息 |
|------|--------|------|----------|
| 1 | InvalidParameter | catalog_id | 目录不存在或已删除 |
| 2 | InvalidParameter | ch_name,org_type | 码表中文名称、标准分类不能全部重复 |
| 3 | InvalidParameter | en_name,org_type | 码表英文名称、标准分类不能全部重复 |
| 4 | InvalidParameter | enum[N].code | 码值输入不能为空 |
| 5 | InvalidParameter | enum[N].value | 码值描述输入不能为空 |
| 6 | InvalidParameter | code | 码值出现重复记录 |

---

### 5.4 修改码表

**接口路径**：`PUT /api/standardization/v1/dataelement/dict/{id}`

#### 业务逻辑

```
1. 校验码表存在性
2. 校验参数
3. 检查是否需要更新版本（名称/目录/部门/分类/说明/关联文件/码值变更）
4. 无变更直接返回
5. 有变更则更新数据（版本号+1、更新关联文件、重新保存码值）
```

---

### 5.5 删除码表

**接口路径**：`DELETE /api/standardization/v1/dataelement/dict/{id}`

#### 业务逻辑

```
1. 校验码表存在性
2. 物理删除码表
3. 删除码值明细
```

---

### 5.6 批量删除码表

**接口路径**：`DELETE /api/standardization/v1/dataelement/dict/batch/{ids}`

#### 请求参数

- 路径参数：ids（多个ID用英文逗号分隔）

---

### 5.7 启用/停用码表

**接口路径**：`PUT /api/standardization/v1/dataelement/dict/state/{id}`

#### 请求参数

```json
{
  "state": "disable",
  "reason": "停用原因"
}
```

#### 业务逻辑

```
1. 校验码表存在性
2. state=disable时校验停用原因（必填）
3. 更新状态
```

---

### 5.8 码值分页查询

**接口路径**：`GET /api/standardization/v1/dataelement/dict/enum`

#### 请求参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| dict_id | Long | 是 | 码表ID |
| keyword | String | 否 | 搜索关键字 |
| offset | Integer | 否 | 分页页码，默认1 |
| limit | Integer | 否 | 条数，默认20 |

---

### 5.9 查询引用码表的数据元

**接口路径**：`GET /api/standardization/v1/dataelement/dict/dataelement/{id}`

#### 请求参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | Long | 是 | 码表ID |
| offset | Integer | 否 | 分页页码，默认1 |
| limit | Integer | 否 | 条数，默认20 |

---

### 5.10 按文件目录查询

**接口路径**：`GET /api/standardization/v1/dataelement/dict/queryByStdFileCatalog`

#### 请求参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| catalog_id | Long | 是 | 文件目录ID |
| keyword | String | 否 | 搜索关键字 |
| org_type | Integer | 否 | 标准分类 |
| state | String | 否 | enable/disable |
| offset | Integer | 否 | 分页页码，默认1 |
| limit | Integer | 否 | 条数，默认20 |

#### 特殊说明

- catalog_id=-1：查询未关联任何文件的码表
- 顶级目录：返回所有码表

---

### 5.11 按文件查询

**接口路径**：`GET /api/standardization/v1/dataelement/dict/queryByStdFile`

#### 请求参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| file_id | Long | 是 | 文件ID |
| keyword | String | 否 | 搜索关键字 |
| org_type | Integer | 否 | 标准分类 |
| state | String | 否 | enable/disable |
| offset | Integer | 否 | 分页页码，默认1 |
| limit | Integer | 否 | 条数，默认20 |
| department_id | String | 否 | 部门ID |

---

### 5.12 查询关联标准文件

**接口路径**：`GET /api/standardization/v1/dataelement/dict/relation/stdfile/{id}`

#### 请求参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | Long | 是 | 码表ID |
| offset | Integer | 否 | 分页页码，默认1 |
| limit | Integer | 否 | 条数，默认20 |

---

### 5.13 添加关联关系

**接口路径**：`PUT /api/standardization/v1/dataelement/dict/relation/{id}`

#### 请求参数

```json
{
  "stdFiles": [1, 2, 3]
}
```

#### 业务逻辑

```
1. 替换码表的关联文件
2. 关联文件变更时更新码表版本号
```

---

### 5.14 查询数据是否存在

**接口路径**：`GET /api/standardization/v1/dataelement/dict/queryDataExists`

#### 请求参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| filter_id | Long | 否 | 过滤ID |
| org_type | Integer | 是 | 标准分类 |
| ch_name | String | 否 | 中文名称 |
| en_name | String | 否 | 英文名称 |
| departmentIds | String | 否 | 部门ID |

---

### 5.15 导入导出

**导入**：`POST /api/standardization/v1/dataelement/dict/import`
**导出**：`POST /api/standardization/v1/dataelement/dict/export`

---

## 六、Go语言开发参考

### 6.1 关键Go结构体示例

```go
// 码表实体
type Dict struct {
    ID             int64   `json:"id" gorm:"primaryKey;column:f_id"`
    Code           int64   `json:"code" gorm:"column:f_code"`
    ChName         string  `json:"chName" gorm:"column:f_ch_name"`
    EnName         string  `json:"enName" gorm:"column:f_en_name"`
    Description    string  `json:"description" gorm:"column:f_description"`
    CatalogID      int64   `json:"catalogId" gorm:"column:f_catalog_id"`
    OrgType        int     `json:"orgType" gorm:"column:f_org_type"`
    Version        int     `json:"version" gorm:"column:f_version"`
    State          int     `json:"state" gorm:"column:f_state"`
    DisableReason  string  `json:"disableReason" gorm:"column:f_disable_reason"`
    DepartmentIDs  string  `json:"departmentIds" gorm:"column:f_department_ids"`
    ThirdDeptID    string  `json:"thirdDeptId" gorm:"column:f_third_dept_id"`
    CreateTime     string  `json:"createTime" gorm:"column:f_create_time"`
    CreateUser     string  `json:"createUser" gorm:"column:f_create_user"`
    UpdateTime     string  `json:"updateTime" gorm:"column:f_update_time"`
    UpdateUser     string  `json:"updateUser" gorm:"column:f_update_user"`
    Deleted        int     `json:"deleted" gorm:"column:f_deleted"`
}

// 码值实体
type DictEnum struct {
    ID         int64   `json:"id" gorm:"primaryKey;column:f_id"`
    DictID     int64   `json:"dictId" gorm:"column:f_dict_id"`
    Code       string  `json:"code" gorm:"column:f_code"`
    Value      string  `json:"value" gorm:"column:f_value"`
    CreateTime string  `json:"createTime" gorm:"column:f_create_time"`
    CreateUser string  `json:"createUser" gorm:"column:f_create_user"`
}
```

---

> 文档结束

> 最后更新时间：2026-02-06
> 维护者：Claude Code
