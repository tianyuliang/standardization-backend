# 标准文件管理接口流程说明文档

> 文档版本：2.0（完整版）
> 创建日期：2026-02-04
> 更新时间：2026-02-06
> 适用版本：standardization-backend v1.0+

---

## 一、业务概述

### 1.1 功能描述

标准文件管理模块用于管理系统中的标准文件（Standard File），支持以下核心功能：

- **文件管理**：支持标准文件的上传、下载、查询
- **文件查询**：支持按目录、关键字、状态等多维度分页查询
- **文件编辑**：支持修改文件信息
- **文件删除**：支持批量删除
- **启用/停用**：支持启用/停用操作
- **关联管理**：支持关联数据元、码表、编码规则

### 1.2 基础路径

```
基础路径：/api/standardization/v1/std-file
```

### 1.3 接口清单（共16个）

| 序号 | 方法 | 路径 | 功能说明 |
|------|------|------|----------|
| 1 | POST | `/v1/std-file` | 新增标准文件 |
| 2 | PUT | `/v1/std-file/{id}` | 修改标准文件 |
| 3 | GET | `/v1/std-file` | 分页列表查询 |
| 4 | GET | `/v1/std-file/{id}` | 详情查询 |
| 5 | DELETE | `/v1/std-file/delete/{ids}` | 批量删除 |
| 6 | PUT | `/v1/std-file/state/{id}` | 启用/停用 |
| 7 | POST | `/v1/std-file/catalog/remove` | 移动目录 |
| 8 | GET | `/v1/std-file/download/{id}` | 下载附件 |
| 9 | POST | `/v1/std-file/downloadBatch` | 批量下载 |
| 10 | GET | `/v1/std-file/relation/de/{id}` | 查询关联数据元 |
| 11 | GET | `/v1/std-file/relation/dict/{id}` | 查询关联码表 |
| 12 | GET | `/v1/std-file/relation/rule/{id}` | 查询关联编码规则 |
| 13 | PUT | `/v1/std-file/relation/{id}` | 添加关联关系 |
| 14 | GET | `/v1/std-file/relation/{id}` | 查询关联关系 |
| 15 | GET | `/v1/std-file/queryDataExists` | 查询数据是否存在 |
| 16 | PUT | `/v1/std-file/batchState` | 批量启用/停用 |

---

## 二、数据库表结构

### 2.1 标准文件表（t_std_file_mgr）

```sql
CREATE TABLE `t_std_file_mgr` (
  `f_id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '主键',
  `f_number` varchar(64) DEFAULT NULL COMMENT '标准编号',
  `f_name` varchar(256) NOT NULL COMMENT '标准文件名称',
  `f_catalog_id` bigint(20) NOT NULL COMMENT '目录ID',
  `f_act_date` datetime DEFAULT NULL COMMENT '实施日期',
  `f_publish_date` datetime DEFAULT NULL COMMENT '发布日期',
  `f_attachment_type` INT(2) NOT NULL DEFAULT 0 COMMENT '附件类型：0-文件附件，1-外置链接',
  `f_attachment_url` varchar(500) DEFAULT NULL COMMENT '链接地址',
  `f_file_name` varchar(256) DEFAULT NULL COMMENT '文件名',
  `f_org_type` INT(2) NOT NULL COMMENT '标准组织类型',
  `f_description` varchar(300) DEFAULT NULL COMMENT '说明',
  `f_state` INT(2) NOT NULL DEFAULT 1 COMMENT '状态：1-启用，0-停用',
  `f_authority_id` varchar(100) DEFAULT NULL COMMENT '权限域',
  `f_department_ids` varchar(350) DEFAULT NULL COMMENT '部门ID',
  `f_third_dept_id` varchar(36) DEFAULT NULL COMMENT '第三方部门ID',
  `f_create_time` datetime DEFAULT NULL COMMENT '创建时间',
  `f_create_user` varchar(128) DEFAULT NULL COMMENT '创建用户',
  `f_update_time` datetime DEFAULT NULL COMMENT '修改时间',
  `f_update_user` varchar(128) DEFAULT NULL COMMENT '修改用户',
  `f_deleted` bigint(20) NOT NULL DEFAULT 0 COMMENT '逻辑删除标记',
  PRIMARY KEY (`f_id`),
  KEY `idx_catalog_id` (`f_catalog_id`),
  KEY `idx_org_type` (`f_org_type`)
) COMMENT='标准文件管理表';
```

---

## 三、枚举定义

### 3.1 标准分类枚举（OrgTypeEnum）

| 枚举值 | code | 说明 |
|--------|------|------|
| GROUP | 0 | 团体标准 |
| ENTERPRISE | 1 | 企业标准 |
| INDUSTRY | 2 | 行业标准 |
| LOCAL | 3 | 地方标准 |
| NATIONAL | 4 | 国家标准 |
| INTERNATIONAL | 5 | 国际标准 |
| FOREIGN | 6 | 国外标准 |
| OTHER | 99 | 其他标准 |

### 3.2 启用停用状态枚举（EnableDisableStatusEnum）

| 枚举值 | code | 说明 |
|--------|------|------|
| ENABLE | 1 | 启用 |
| DISABLE | 0 | 停用 |

### 3.3 附件类型枚举

| 枚举值 | code | 说明 |
|--------|------|------|
| FILE | 0 | 文件附件 |
| URL | 1 | 外置链接 |

---

## 四、数据模型定义

### 4.1 创建标准文件请求

```json
{
  "number": "DB3502/T 035-2022",
  "name": "标准文件名称",
  "catalogId": 35,
  "actDate": "2022-01-01",
  "publishDate": "2021-12-01",
  "attachmentType": "FILE",
  "fileName": "文件.pdf",
  "orgType": 0,
  "description": "说明",
  "departmentIds": "a/ab"
}
```

| 字段名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| number | String | 否 | 标准编号，最大64字符 |
| name | String | 是 | 标准文件名称，最大256字符 |
| catalogId | Long | 是 | 目录ID |
| actDate | String | 否 | 实施日期 |
| publishDate | String | 否 | 发布日期 |
| attachmentType | String | 是 | 附件类型：FILE/URL |
| attachmentUrl | String | 条件 | 链接地址，attachmentType=URL时必填 |
| fileName | String | 条件 | 文件名，attachmentType=FILE时必填 |
| orgType | Integer | 是 | 标准分类：0-99 |
| description | String | 否 | 说明，最大300字符 |
| departmentIds | String | 否 | 部门ID |

### 4.2 标准文件响应（StdFileMgrVo）

```json
{
  "id": 1234567890,
  "number": "DB3502/T 035-2022",
  "name": "标准文件名称",
  "catalogId": 35,
  "catalogName": "文件目录",
  "actDate": "2022-01-01",
  "publishDate": "2021-12-01",
  "attachmentType": "FILE",
  "attachmentUrl": "",
  "fileName": "文件.pdf",
  "orgType": 0,
  "description": "说明",
  "state": "enable",
  "departmentId": "a/ab",
  "departmentName": "部门A",
  "departmentPathNames": "部门A/部门B",
  "createTime": "2022-11-21 12:00:00",
  "createUser": "创建用户",
  "updateTime": "2022-11-21 12:00:00",
  "updateUser": "修改用户"
}
```

### 4.3 统一响应结构

```json
{
  "code": "0",
  "description": "操作成功",
  "data": {...},
  "totalCount": 100
}
```

---

## 五、接口详细说明

### 5.1 新增标准文件

**接口路径**：`POST /api/standardization/v1/std-file`

#### 请求参数

参考创建标准文件请求

#### 业务逻辑

```
1. 参数校验
2. 业务校验（目录存在性）
3. 生成ID（雪花算法）
4. 设置创建信息
5. 保存数据库
```

#### 异常提示

| 序号 | 错误码 | 字段 | 提示信息 |
|------|--------|------|----------|
| 1 | InvalidParameter | catalog_id | 目录id[%s]对应的目录不存在 |
| 2 | InvalidParameter | number | 标准编号已存在 |

---

### 5.2 分页列表查询

**接口路径**：`GET /api/standardization/v1/std-file`

#### 请求参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| catalog_id | Long | 否 | 目录ID |
| keyword | String | 否 | 搜索关键字 |
| org_type | Integer | 否 | 标准分类：0-99 |
| state | String | 否 | enable/disable |
| offset | Integer | 否 | 分页页码，默认1 |
| limit | Integer | 否 | 条数，默认20 |
| sort | String | 否 | 排序字段 |
| direction | String | 否 | asc/desc |
| department_id | String | 否 | 部门ID |

#### 业务逻辑

```
1. 构建查询条件
2. 分页查询
3. 数据处理（查询目录/部门信息）
```

---

### 5.3 详情查询

**接口路径**：`GET /api/standardization/v1/std-file/{id}`

#### 响应参数

返回完整StdFileMgrVo

---

### 5.4 修改标准文件

**接口路径**：`PUT /api/standardization/v1/std-file/{id}`

#### 请求参数

参考创建标准文件请求

#### 业务逻辑

```
1. 校验文件存在性
2. 校验参数
3. 更新文件信息
4. 设置更新信息
```

---

### 5.5 批量删除

**接口路径**：`DELETE /api/standardization/v1/std-file/delete/{ids}`

#### 请求参数

- 路径参数：ids（多个ID用英文逗号分隔）

#### 业务逻辑

```
1. 解析ID列表
2. 物理删除文件
3. 删除关联关系
```

---

### 5.6 启用/停用

**接口路径**：`PUT /api/standardization/v1/std-file/state/{id}`

#### 请求参数

```json
{
  "state": "disable"
}
```

---

### 5.7 移动目录

**接口路径**：`POST /api/standardization/v1/std-file/catalog/remove`

#### 请求参数

```json
{
  "ids": [1, 2, 3],
  "catalogId": 331
}
```

---

### 5.8 下载附件

**接口路径**：`GET /api/standardization/v1/std-file/download/{id}`

#### 特殊说明

- attachmentType=FILE：从OSS/Anyshare下载
- attachmentType=URL：重定向到链接地址

---

### 5.9 批量下载

**接口路径**：`POST /api/standardization/v1/std-file/downloadBatch`

#### 请求参数

```json
{
  "ids": [1, 2, 3]
}
```

---

### 5.10 查询关联数据元

**接口路径**：`GET /api/standardization/v1/std-file/relation/de/{id}`

#### 请求参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | Long | 是 | 文件ID |
| offset | Integer | 否 | 分页页码，默认1 |
| limit | Integer | 否 | 条数，默认20 |

---

### 5.11 查询关联码表

**接口路径**：`GET /api/standardization/v1/std-file/relation/dict/{id}`

---

### 5.12 查询关联编码规则

**接口路径**：`GET /api/standardization/v1/std-file/relation/rule/{id}`

---

### 5.13 添加关联关系

**接口路径**：`PUT /api/standardization/v1/std-file/relation/{id}`

#### 请求参数

```json
{
  "deIds": [1, 2, 3],
  "dictIds": [1, 2, 3],
  "ruleIds": [1, 2, 3]
}
```

#### 业务逻辑

```
1. 替换文件的关联关系
2. 批量插入关联记录
```

---

### 5.14 查询关联关系

**接口路径**：`GET /api/standardization/v1/std-file/relation/{id}`

#### 响应参数

返回所有关联的数据元ID、码表ID、编码规则ID列表

---

### 5.15 查询数据是否存在

**接口路径**：`GET /api/standardization/v1/std-file/queryDataExists`

#### 请求参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| number | String | 是 | 标准编号 |
| filter_id | Long | 否 | 过滤ID |

---

### 5.16 批量启用/停用

**接口路径**：`PUT /api/standardization/v1/std-file/batchState`

#### 请求参数

```json
{
  "ids": [1, 2, 3],
  "state": "disable"
}
```

---

## 六、Go语言开发参考

### 6.1 关键Go结构体示例

```go
// 标准文件实体
type StdFile struct {
    ID             int64   `json:"id" gorm:"primaryKey;column:f_id"`
    Number         string  `json:"number" gorm:"column:f_number"`
    Name           string  `json:"name" gorm:"column:f_name"`
    CatalogID      int64   `json:"catalogId" gorm:"column:f_catalog_id"`
    ActDate        string  `json:"actDate" gorm:"column:f_act_date"`
    PublishDate    string  `json:"publishDate" gorm:"column:f_publish_date"`
    AttachmentType int     `json:"attachmentType" gorm:"column:f_attachment_type"`
    AttachmentURL  string  `json:"attachmentUrl" gorm:"column:f_attachment_url"`
    FileName       string  `json:"fileName" gorm:"column:f_file_name"`
    OrgType        int     `json:"orgType" gorm:"column:f_org_type"`
    Description    string  `json:"description" gorm:"column:f_description"`
    State          int     `json:"state" gorm:"column:f_state"`
    DepartmentIDs  string  `json:"departmentIds" gorm:"column:f_department_ids"`
    ThirdDeptID    string  `json:"thirdDeptId" gorm:"column:f_third_dept_id"`
    CreateTime     string  `json:"createTime" gorm:"column:f_create_time"`
    CreateUser     string  `json:"createUser" gorm:"column:f_create_user"`
    UpdateTime     string  `json:"updateTime" gorm:"column:f_update_time"`
    UpdateUser     string  `json:"updateUser" gorm:"column:f_update_user"`
    Deleted        int     `json:"deleted" gorm:"column:f_deleted"`
}
```

---

> 文档结束

> 最后更新时间：2026-02-06
> 维护者：Claude Code
